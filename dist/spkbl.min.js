var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;for(var n=Array(t),r=0,e=0;e<s;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,r++)n[r]=i[o];return n};!function(s,n){var r=[],i=null,a=/[’'‘`“”"[\](){}…,.!;?\-:\u0964\u0965]/,o={selector:".spkbl",multivoice:!0,l18n:{play:"Read text",pause:"Pause",progress:"Progress",stop:"Resume"}},e=["address","article","aside","blockquote","details","dialog","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","ol","p","pre","section","table","ul"];function l(t,e){this.lang=t,this.multivoice=e,this.items=[]}function h(t){return t&&"object"==typeof t&&!Array.isArray(t)}function p(t){for(var e,s=[],n=1;n<arguments.length;n++)s[n-1]=arguments[n];if(!s.length)return t;var r=s.shift();if(h(t)&&h(r))for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&h(r[i])?(t[i]||Object.assign(t,((e={})[i]={},e)),p(t[i],r[i])):Object.assign(t,((e={})[i]=r[i],e));return p.apply(void 0,__spreadArrays([t],s))}function c(t,e){this.element=t,this.options=this.configure(e,"data-spkbl"),this.utterances=[],this.currentUtterance=0,this.length=0,this.offset=0,this.progress=0,this.paused=!1,this.nextOnResume=!1,this.player=null,this.controls={},this.buildPlayer();e=new l(this.determineLanguage(this.element)||"en",this.options.multivoice);this.setUtterances(e.chunked(this.element)),this.injectPlayer()}l.prototype.parse=function(t){var s=this;return t.childNodes.forEach(function(t){var e;t.nodeType===Element.ELEMENT_NODE?(e=s.multivoice&&t.lang||s.lang,s.items.push({type:1+s.isBlockLevelElement(t),lang:e,node:t,items:new l(e,s.multivoice).parse(t)})):t.nodeType!==Element.TEXT_NODE||(e=t.nodeValue.trim().replace(/[\s\r\n]+/g," ")).length&&s.items.push({type:0,lang:s.lang,node:t,text:e})}),this.items},l.prototype.isBlockLevelElement=function(t){return-1!==e.indexOf(t.tagName.toLowerCase())},l.prototype.chunked=function(t){var s=[],n=null,r=function(t){if(null===n)n=t.type?(n={lang:t.lang,chunks:[]},t.items.forEach(r),n&&n.chunks.length&&s.push(n),null):{lang:t.lang,chunks:[{node:t.node,text:t.text}]};else switch(t.type){case 2:n.chunks.length?(s.push(n),n={lang:t.lang,chunks:[]}):n.lang=t.lang,t.items.forEach(r),n&&n.chunks.length&&s.push(n),n=null;break;case 1:var e;t.lang===n.lang?t.items.forEach(r):(e=n.lang,n.chunks.length&&s.push(n),n={lang:t.lang,chunks:[]},t.items.forEach(r),n.chunks.length&&s.push(n),n={lang:e,chunks:[]});break;default:n.chunks.push({node:t.node,text:t.text})}};if(this.parse(t).forEach(r),n&&n.chunks.length&&(s[s.length]=n),s.length){for(var e=[s.shift()];s.length;){var i=s.shift(),o=e.length-1;i.lang===e[o].lang?Array.prototype.push.apply(e[o].chunks,i.chunks):e.push(i)}return e.forEach(function(t){var e=0;t.chunks.forEach(function(t){t.char=e,a.test(t.text.substr(-1))||(t.text+="."),e+=t.text.length+1})}),e}return[]},c.prototype.configure=function(t,e){var s,n,r={};for(s in t){Object.prototype.hasOwnProperty.call(t,s)&&(n=e+"-"+s,h(t[s])?r[s]=this.configure(t[s],n):this.element.hasAttribute(n)?r[s]="1"===(n=this.element.getAttribute(n))||"true"===n.toLowerCase()||"0"!==n&&"false"!==n.toLowerCase()&&n:r[s]=t[s])}return r},c.prototype.determineLanguage=function(t){return t.lang||(t.parentNode?this.determineLanguage(t.parentNode):null)},c.prototype.buildPlayer=function(){this.player=n.createElement("div"),this.player.className="spkbl-player spkbl-player--inactive",this.player.role="group",this.controls.play=n.createElement("button"),this.controls.play.type="button",this.controls.play.className="spkbl-ctrl spkbl-ctrl--play",this.controls.play.addEventListener("click",this.play.bind(this)),this.controls.play.innerHTML=this.options.l18n.play,this.player.appendChild(this.controls.play),this.controls.pause=n.createElement("button"),this.controls.pause.type="button",this.controls.pause.className="spkbl-ctrl spkbl-ctrl--pause",this.controls.pause.addEventListener("click",this.pause.bind(this)),this.controls.pause.innerHTML=this.options.l18n.pause,this.controls.pause.setAttribute("aria-pressed","false"),this.player.appendChild(this.controls.pause),this.controls.progress=n.createElement("progress"),this.controls.progress.className="spkbl-ctrl spkbl-ctrl--progress",this.controls.progress.max="100",this.controls.progress.value="0",this.controls.progress.setAttribute("aria-label",this.options.l18n.progress),this.controls.progress.setAttribute("aria-hidden","true"),this.controls.progress.setAttribute("readonly","true"),this.controls.progress.appendChild(n.createTextNode("0%")),this.player.appendChild(this.controls.progress),this.controls.stop=n.createElement("button"),this.controls.stop.type="button",this.controls.stop.className="spkbl-ctrl spkbl-ctrl--stop",this.controls.stop.addEventListener("click",this.stop.bind(this)),this.controls.stop.innerHTML=this.options.l18n.stop,this.player.appendChild(this.controls.stop)},c.prototype.setUtterances=function(t){var e=this;this.length=0,this.utterances=t.map(function(t){return t.text=t.chunks.map(function(t){return t.text}).join(" "),t.length=t.text.length,e.length+=t.length+1,t}),this.length+=1},c.prototype.play=function(t){c.current&&c.current.halt(),(c.current=this).player.classList.add("spkbl-player--active"),this.player.classList.remove("spkbl-player--inactive"),this.controls.pause.focus(),n.addEventListener("keyup",this.escape.bind(this)),this.currentUtterance=-1,this.offset=0,this.progress=0,speechSynthesis.cancel(),i.onboundary=this.boundary.bind(this),i.onend=this.next.bind(this),this.next(t)},c.prototype.escape=function(t){t=t||window.event,t="key"in t?"Escape"===t.key||"Esc"===t.key:27===t.keyCode;t&&this.stop()},c.prototype.next=function(t){var e;this.paused?(this.nextOnResume=!0,speechSynthesis.cancel()):this.utterances.length>this.currentUtterance+1?(0<=this.currentUtterance&&(this.offset+=this.utterances[this.currentUtterance].length+1),this.currentUtterance+=1,e=this.utterances[this.currentUtterance],i.text=e.text,i.voice=this.getUtteranceVoice(e),speechSynthesis.speak(i)):this.stop(t)},c.prototype.getUtteranceVoice=function(e){return e.voice||(e.voice=r.find(function(t){return t.lang===e.lang||t.lang.startsWith(e.lang+"-")})||r.find(function(t){return t.default})||r[0]),e.voice},c.prototype.boundary=function(t){this.progress=Math.round(100*(this.offset+t.charIndex)/this.length),this.controls.progress.value=this.progress,this.controls.progress.textContent=this.progress+" % "},c.prototype.pause=function(){speechSynthesis[this.togglePause(this.paused)?"pause":"resume"](),this.nextOnResume&&(this.nextOnResume=!1,this.next())},c.prototype.togglePause=function(t){return t?(this.paused=!1,this.player.classList.remove("spkbl-player--paused"),this.controls.pause.setAttribute("aria-pressed","false")):(this.paused=!0,this.player.classList.add("spkbl-player--paused"),this.controls.pause.setAttribute("aria-pressed","true")),this.paused},c.prototype.stop=function(){this.halt(),this.controls.play.focus()},c.prototype.halt=function(){i.onboundary=null,i.onend=null,speechSynthesis.cancel(),this.togglePause(!0),n.removeEventListener("keyup",this.escape.bind(this)),this.player.classList.add("spkbl-player--inactive"),this.player.classList.remove("spkbl-player--active"),this.player.classList.remove("spkbl-player--paused")},c.prototype.injectPlayer=function(){if("function"!=typeof this.options.insert)switch(this.options.insert){case"before":this.element.parentNode.insertBefore(this.player,this.element);break;case"after":this.element.parentNode.insertBefore(this.player,this.element.nextSibling);break;default:this.element.insertBefore(this.player,this.element.firstChild)}else this.options.insert(this.element,this.player)},c.init=function(t){if(void 0===t&&(t={}),"SpeechSynthesisUtterance"in s){(i=new SpeechSynthesisUtterance).volume=1,i.pitch=1,i.rate=1,r=speechSynthesis.getVoices(),speechSynthesis.addEventListener("voiceschanged",function(){r=speechSynthesis.getVoices()});var e=p(o,t),t=e.selector||"";return t.length?Array.from(n.querySelectorAll(t)).map(function(t){return new c(t,e)}):[]}return[]},c.current=null,"undefined"!=typeof exports?exports.Speakable=c:s.Speakable=c}("undefined"!=typeof global?global:window,document);