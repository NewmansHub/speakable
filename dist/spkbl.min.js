/* Speakable Text-To-Speech player 1.0.0 | https://github.com/tollwerk/speakable */
var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;for(var n=Array(t),r=0,e=0;e<s;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,r++)n[r]=i[o];return n};!function(s,n){var r=[],i=null,o=/[’'‘`“”"[\](){}…,.!;?\-:\u0964\u0965]\s*$/,a=/[·*]|(?:(?<=\w):(?=\w))/gi,l={selector:".spkbl",multivoice:!0,hidden:!0,l18n:{play:"Read text",pause:"Pause",progress:"Progress",stop:"Resume"}},h=["address","article","aside","blockquote","details","dialog","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","ol","p","pre","section","table","ul"];function p(t){return t&&"object"==typeof t&&!Array.isArray(t)}function c(t){for(var e,s=[],n=1;n<arguments.length;n++)s[n-1]=arguments[n];if(!s.length)return t;var r=s.shift();if(p(t)&&p(r))for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&p(r[i])?(t[i]||Object.assign(t,((e={})[i]={},e)),c(t[i],r[i])):Object.assign(t,((e={})[i]=r[i],e));return c.apply(void 0,__spreadArrays([t],s))}function u(t,e){this.lang=t,this.multivoice=e,this.items=[]}function d(t,e){this.element=t,this.options=this.configure(e,"data-spkbl"),this.utterances=[],this.currentUtterance=0,this.length=0,this.offset=0,this.progress=0,this.paused=!1,this.nextOnResume=!1,this.player=null,this.controls={},this.buildPlayer();e=new u(this.determineLanguage(this.element)||"en",this.options.multivoice);this.setUtterances(e.chunked(this.element)),this.injectPlayer()}u.prototype.parse=function(t){var n=this;return t.childNodes.forEach(function(t){var e,s;t.nodeType===Element.ELEMENT_NODE?t.hasAttribute("data-spkbl-skip")||(e=n.multivoice&&t.lang||n.lang,n.items.push({type:1+(s=t,-1!==h.indexOf(s.tagName.toLowerCase())),lang:e,node:t,items:new u(e,n.multivoice).parse(t)})):t.nodeType!==Element.TEXT_NODE||(e=t.nodeValue).trim().length&&(e=(e=e.replace(/[\s\r\n]+/g," ")).replace(a,""),n.items.push({type:0,lang:n.lang,node:t,text:e}))}),this.items},u.prototype.createSentence=function(t){return{lang:t,chunks:[]}},u.prototype.createChunks=function(t){var s=this,n=[],r=null,i=function(t){if(null===r)r=s.createSentence(t.lang),t.type?(t.items.forEach(i),r&&r.chunks.length&&n.push(r),r=null):r.chunks.push({node:t.node,text:t.text});else switch(t.type){case 2:r.chunks.length?(n.push(r),r=s.createSentence(t.lang)):r.lang=t.lang,t.items.forEach(i),r&&r.chunks.length&&n.push(r),r=null;break;case 1:var e;t.lang===r.lang?t.items.forEach(i):(e=r.lang,r.chunks.length&&n.push(r),r=s.createSentence(t.lang),t.items.forEach(i),r.chunks.length&&n.push(r),r=s.createSentence(e));break;default:r.chunks.push({node:t.node,text:t.text})}};return this.parse(t).forEach(i),r&&r.chunks.length&&(n[n.length]=r),n},u.prototype.map=function(t){var e={lang:t.lang,text:"",map:new Map};return t.chunks.forEach(function(t){e.map.set(e.text.length,t.node),e.text+=t.text}),e},u.prototype.chunked=function(t){t=this.createChunks(t);if(!t.length)return[];for(var e=t.map(this.map),r=[e.shift()];e.length;)!function(){var s,t=e.shift(),n=r.length-1;t.lang===r[n].lang?(o.test(r[n].text)||(r[n].text+="."),r[n].text=r[n].text.trim()+" ",s=r[n].text.length,r[n].text+=t.text,t.map.forEach(function(t,e){r[n].map.set(s+e,t)})):r.push(t)}();return r},d.prototype.configure=function(t,e){var s,n,r={};for(s in t){Object.prototype.hasOwnProperty.call(t,s)&&(n=e+"-"+s,p(t[s])?r[s]=this.configure(t[s],n):this.element.hasAttribute(n)?r[s]="1"===(n=this.element.getAttribute(n))||"true"===n.toLowerCase()||"0"!==n&&"false"!==n.toLowerCase()&&n:r[s]=t[s])}return r},d.prototype.determineLanguage=function(t){return t.lang||(t.parentNode?this.determineLanguage(t.parentNode):null)},d.prototype.buildPlayer=function(){this.player=n.createElement("div"),this.player.className="spkbl-player spkbl-player--inactive",this.player.role="group",this.options.hidden&&this.player.setAttribute("aria-hidden","true"),this.controls.play=n.createElement("button"),this.controls.play.type="button",this.controls.play.className="spkbl-ctrl spkbl-ctrl--play",this.controls.play.addEventListener("click",this.play.bind(this)),this.controls.play.innerHTML=this.options.l18n.play,this.player.appendChild(this.controls.play),this.controls.pause=n.createElement("button"),this.controls.pause.type="button",this.controls.pause.className="spkbl-ctrl spkbl-ctrl--pause",this.controls.pause.addEventListener("click",this.pause.bind(this)),this.controls.pause.innerHTML=this.options.l18n.pause,this.controls.pause.setAttribute("aria-pressed","false"),this.player.appendChild(this.controls.pause),this.controls.progress=n.createElement("progress"),this.controls.progress.className="spkbl-ctrl spkbl-ctrl--progress",this.controls.progress.max="100",this.controls.progress.value="0",this.controls.progress.setAttribute("aria-label",this.options.l18n.progress),this.controls.progress.setAttribute("aria-hidden","true"),this.controls.progress.setAttribute("readonly","true"),this.controls.progress.appendChild(n.createTextNode("0%")),this.player.appendChild(this.controls.progress),this.controls.stop=n.createElement("button"),this.controls.stop.type="button",this.controls.stop.className="spkbl-ctrl spkbl-ctrl--stop",this.controls.stop.addEventListener("click",this.stop.bind(this)),this.controls.stop.innerHTML=this.options.l18n.stop,this.player.appendChild(this.controls.stop)},d.prototype.setUtterances=function(t){var e=this;this.length=0,this.utterances=t.map(function(t){return t.length=t.text.length,e.length+=t.length+1,t}),this.length+=1},d.prototype.play=function(t){d.current&&d.current.halt(),(d.current=this).player.classList.add("spkbl-player--active"),this.player.classList.remove("spkbl-player--inactive"),this.controls.pause.focus(),n.addEventListener("keyup",this.escape.bind(this)),this.currentUtterance=-1,this.offset=0,this.progress=0,speechSynthesis.cancel(),i.onboundary=this.boundary.bind(this),i.onend=this.next.bind(this),this.next(t)},d.prototype.escape=function(t){t=t||window.event;("key"in t?"Escape"===t.key||"Esc"===t.key:27===t.keyCode)&&this.stop()},d.prototype.next=function(t){var e;this.paused?(this.nextOnResume=!0,speechSynthesis.cancel()):this.utterances.length>this.currentUtterance+1?(0<=this.currentUtterance&&(this.offset+=this.utterances[this.currentUtterance].length+1),this.currentUtterance+=1,e=this.utterances[this.currentUtterance],i.text=e.text,i.voice=this.getUtteranceVoice(e),speechSynthesis.speak(i)):this.stop(t)},d.prototype.getUtteranceVoice=function(t){var e,s;return t.voice||(e=t.lang,s=e.split("-").shift(),t.voice=r.find(function(t){return t.lang===e||t.lang===s||t.lang.startsWith(e+"-")||t.lang.startsWith(s+"-")})||r.find(function(t){return t.default})||r[0]),t.voice},d.prototype.boundary=function(t){this.progress=Math.round(100*(this.offset+t.charIndex)/this.length),this.controls.progress.value=this.progress,this.controls.progress.textContent=this.progress+" % "},d.prototype.pause=function(){speechSynthesis[this.togglePause(this.paused)?"pause":"resume"](),this.nextOnResume&&(this.nextOnResume=!1,this.next())},d.prototype.togglePause=function(t){return this.paused=!t,this.player.classList[t?"remove":"add"]("spkbl-player--paused"),this.controls.pause.setAttribute("aria-pressed",t?"false":"true"),this.paused},d.prototype.stop=function(){this.halt(),this.controls.play.focus()},d.prototype.halt=function(){i.onboundary=null,i.onend=null,speechSynthesis.cancel(),this.togglePause(!0),n.removeEventListener("keyup",this.escape.bind(this)),this.player.classList.add("spkbl-player--inactive"),this.player.classList.remove("spkbl-player--active"),this.player.classList.remove("spkbl-player--paused")},d.prototype.injectPlayer=function(){if("function"!=typeof this.options.insert)switch(this.options.insert){case"before":this.element.parentNode.insertBefore(this.player,this.element);break;case"after":this.element.parentNode.insertBefore(this.player,this.element.nextSibling);break;default:this.element.insertBefore(this.player,this.element.firstChild)}else this.options.insert(this.element,this.player)},d.current=null,d.init=function(t){if(void 0===t&&(t={}),"SpeechSynthesisUtterance"in s){(i=new SpeechSynthesisUtterance).volume=1,i.pitch=1,i.rate=1,r=speechSynthesis.getVoices(),speechSynthesis.addEventListener&&speechSynthesis.addEventListener("voiceschanged",function(){r=speechSynthesis.getVoices()});var e=c(l,t),t=e.selector||"";return delete e.selector,t.length?Array.from(n.querySelectorAll(t)).map(function(t){return new d(t,e)}):[]}return[]},"undefined"!=typeof exports?exports.Speakable=d:s.Speakable=d}("undefined"!=typeof global?global:window,document);