!function(s,n){"use strict";var r={selector:".spkbl",insert:"before"},e={play:"Text vorlesen",pause:"Pause",progress:"Fortschritt",stop:"SchlieÃŸen"},t=["address","article","aside","blockquote","details","dialog","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","ol","p","pre","section","table","ul"];function i(e){this.lang=e,this.items=[]}i.prototype.parse=function(e){var s=this;return e.childNodes.forEach(function(e){var t;e.nodeType===Element.ELEMENT_NODE?(t=e.lang||s.lang,s.items.push({type:1+s._isBlockLevelElement(e),lang:t,node:e,items:new i(t).parse(e)})):e.nodeType!==Element.TEXT_NODE||(t=e.nodeValue.trim()).length&&s.items.push({type:0,lang:s.lang,node:e,text:t})}),this.items},i.prototype._isBlockLevelElement=function(e){return-1!==t.indexOf(e.tagName.toLowerCase())},i.prototype.chunked=function(){var s=[],n=null,r=function(e){if(null===n)n=e.type?(n={lang:e.lang,chunks:[]},e.items.forEach(r),s.push(n),null):{lang:e.lang,chunks:[{node:e.node,text:e.text}]};else switch(e.type){case 2:n.chunks.length?(s.push(n),n={lang:e.lang,chunks:[]}):n.lang=e.lang,e.items.forEach(r),n.chunks.length&&s.push(n),n=null;break;case 1:var t;e.lang===n.lang?e.items.forEach(r):(t=n.lang,n.chunks.length&&s.push(n),n={lang:e.lang,chunks:[]},e.items.forEach(r),n.chunks.length&&s.push(n),n={lang:t,chunks:[]});break;default:n.chunks.push({node:e.node,text:e.text})}};if(this.items.forEach(r),n&&n.chunks.length&&s.push(n),s.length){var e=[s.shift()];do{var t=s.shift(),i=e.length-1;t.lang===e[i].lang?Array.prototype.push.apply(e[i].chunks,t.chunks):e.push(t)}while(s.length);return e.forEach(function(e){var t=0;e.chunks.forEach(function(e){e.char=t,t+=e.text.length+1})}),e}return[]};var o=[],l=null;function a(e,t){this.element=e,this.options=t;t=new i(this._determineLanguage(this.element)||"en");t.parse(this.element),this._utterances=t.chunked(),this._currentUtterance=0,this._length=0,this._offset=0,this._progress=0,this._player=null,this._controls={},this._buildPlayer(),this._injectPlayer()}a.prototype._determineLanguage=function(e){return e.lang||(e.parentNode?this._determineLanguage(e.parentNode):null)},a.prototype._buildPlayer=function(){this._player=n.createElement("div"),this._player.className="spkbl-player spkbl-player--inactive",this._player.role="group",this._controls.play=n.createElement("button"),this._controls.play.type="button",this._controls.play.className="spkbl-ctrl spkbl-ctrl--play",this._controls.play.addEventListener("click",this.play.bind(this)),this._controls.play.appendChild(n.createTextNode(e.play)),this._player.appendChild(this._controls.play),this._controls.pause=n.createElement("button"),this._controls.pause.type="button",this._controls.pause.className="spkbl-ctrl spkbl-ctrl--pause",this._controls.pause.addEventListener("click",this.pause.bind(this)),this._controls.pause.appendChild(n.createTextNode(e.pause)),this._controls.pause.setAttribute("aria-pressed","false"),this._player.appendChild(this._controls.pause),this._controls.progress=n.createElement("progress"),this._controls.progress.className="spkbl-ctrl spkbl-ctrl--progress",this._controls.progress.max="100",this._controls.progress.value="0",this._controls.progress.setAttribute("aria-label",e.progress),this._controls.progress.setAttribute("aria-hidden","true"),this._controls.progress.setAttribute("readonly","true"),this._controls.progress.appendChild(n.createTextNode("0%")),this._player.appendChild(this._controls.progress),this._controls.stop=n.createElement("button"),this._controls.stop.type="button",this._controls.stop.className="spkbl-ctrl spkbl-ctrl--stop",this._controls.stop.addEventListener("click",this.stop.bind(this)),this._controls.stop.appendChild(n.createTextNode(e.stop)),this._player.appendChild(this._controls.stop)},a.prototype.play=function(e){var s=this;this._player.classList.add("spkbl-player--active"),this._player.classList.remove("spkbl-player--inactive"),this._controls.pause.focus(),this._length=-1,this._offset=0,this._progress=0,speechSynthesis.cancel(),l.onboundary=this.boundary.bind(this),l.onend=this.next.bind(this),this._utterances.forEach(function(t){t.voice=o.find(function(e){return e.lang===t.lang||e.lang.startsWith(t.lang+"-")})||o.find(function(e){return e.default})||o[0],t.length=t.chunks.map(function(e){return e.text}).join(" ").length,s._length+=t.length+1}),this._currentUtterance=-1,this.next()},a.prototype.next=function(e){var t;this._utterances.length>this._currentUtterance+1?(0<=this._currentUtterance&&(this._offset+=this._utterances[this._currentUtterance].length+1),++this._currentUtterance,t=this._utterances[this._currentUtterance],l.text=t.chunks.map(function(e){return e.text}).join(" "),l.voice=t.voice,speechSynthesis.speak(l)):this.stop(e)},a.prototype.boundary=function(e){this._progress=Math.round(100*(this._offset+e.charIndex)/this._length),this._controls.progress.value=this._progress,this._controls.progress.textContent=this._progress+"%",console.log(this._progress,e.name,l.text.substr(e.charIndex,e.charLength))},a.prototype.pause=function(e){speechSynthesis.speaking&&(speechSynthesis.paused?(speechSynthesis.resume(),this._player.classList.remove("spkbl-player--paused"),this._controls.pause.setAttribute("aria-pressed","false")):(speechSynthesis.pause(),this._player.classList.add("spkbl-player--paused"),this._controls.pause.setAttribute("aria-pressed","true")))},a.prototype.stop=function(e){this._player.classList.add("spkbl-player--inactive"),this._player.classList.remove("spkbl-player--active"),this._player.classList.remove("spkbl-player--paused"),this._controls.play.focus(),speechSynthesis.cancel()},a.prototype._injectPlayer=function(){if("function"!=typeof this.options.insert)switch(this.options.insert){case"before":this.element.parentNode.insertBefore(this._player,this.element);break;case"after":this.element.parentNode.insertBefore(this._player,this.element.nextSibling);break;default:this.element.insertBefore(this._player,this.element.firstChild)}else this.options.insert(this.element,this._player)},a.init=function(e){if(void 0===e&&(e={}),"SpeechSynthesisUtterance"in s){(l=new SpeechSynthesisUtterance).volume=1,l.pitch=1,l.rate=1,o=speechSynthesis.getVoices(),speechSynthesis.addEventListener("voiceschanged",function(){o=speechSynthesis.getVoices()});var t=Object.assign(r,e),e=t.selector||"";return e.length?Array.from(n.querySelectorAll(e)).map(function(e){return new a(e,t)}):[]}return[]},"undefined"!=typeof exports?exports.Speakable=a:s.Speakable=a}("undefined"!=typeof global?global:window,document);